## 相关概念与原理

### 1、并发与并行

并发：两个或多个事件在同一个时间段内发生，交替执行

并行：两个或多个事件同时发生

### 2、进程与线程

进程：进入内存中运行的程序

线程：进程中的执行单元，进程创建到CPU的执行路径来执行功能，即线程

### 3、主线程

主线程：执行main方法的线程

单线程程序：即Java中仅有一个线程，即main方法的主线程，从上到下执行线程

### 4、线程的实现方式

Thread类中与线程相关的关键方法都有native关键词修饰，包括start()方法，即线程的实现与平台相关

线程的实现方式有三种

##### 内核线程实现（1:1实现）

内核线程直接由操作系统内核支持，通过内核进行调度

而应用程序并不是直接使用内核线程，而是使用内核线程的接口--轻量级进程，即程序使用的线程

- 内核线程与轻量级进程是1:1创建的，轻量级进程依赖于内核线程，因此其创建、同步等操作依赖于系统调用，创建、切换时的系统资源消耗大，且数量不能太多
- 内核线程的实现相对简单

##### 用户线程实现（1:N实现）

用户线程实现的优缺点与内核线程实现一定程度上可以反着比较

用户线程通常是完全建立建立上用户空间中

- 系统内核无法感知用户线程的实现与使用，即系统资源消耗低，数量可以更多
- 用户线程实现会更加复杂

##### 混合实现（N:N实现）

即同时存在轻量级进程和用户线程

##### Hospot虚拟机的线程实现：采用内核线程实现

### 5、Java线程调度

协同式调度：线程的执行时间由线程自己控制，当工作执行完后通知系统切换到另一个线程，若一个线程运行时间太长可能会导致系统崩溃

抢占式调度：线程执行时间由系统分配控制，优先让优先级高的线程使用CPU，若优先级相同则随机使用，Java使用抢占式调度

### 6、协程

根据线程的实现方式来看，Java使用的是内核线程实现方式，线程的创建、切换时系统资源消耗大，且数量少，在面对web应用的超大数量的请求时会力不从心，而使用用户线程实现可以较好的解决这个问题

在早期，用户线程的线程调度方式为协同式调度，因此这种方式也叫“协程”

协程的好处在于轻量级、数量，局限在于实现较为复杂