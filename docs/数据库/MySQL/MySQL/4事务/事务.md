## 事务

### 1、介绍

管理**成批执行**的 SQL 操作，保证数据库不包含不完整的操作结果

若某一步操作出错，可以回退撤销，恢复以前的状态

- 事务：一组 SQL 语句
- 回退：撤销指定 SQL 语句的过程
- 提交：将为存储的 SQL 语句结果写入数据库表，默认是自动提交
  - 查询当前提交提交状态：`select @@autocommit;`
  - 1是自动提交，0是手动提交
- 保留点：事务处理中设置的临时占位符，可用于设置回退的点

### 2、四大特征

- 原子性：是不可分割的最小操作单元，要么同时成功，要么同时失败
- 持久性：当事务提交或回滚后，数据库会持久化的保存数据
- 隔离性：多个事物之间，相互独立
- 一致性：事务操作前后，数据总量不变

### 3、隔离级别

存在问题：

- 脏读：一个事务读取到另一个事务未提交的数据

- 不可重复读：在同一个事务中前后两次读到的数据不同

- 幻读：一个事务操作数据表中的所有记录，另一个事务添加了一条数据，但第一个事务无法查询自己所作的修改

#### 读未提交：read uncommited

产生的问腿：脏读、不可重复读、幻读

#### 读已提交：read commited

产生的问题：不可重复读、幻读

#### 可重复读（MySQL默认）：repeatable read

产生的问腿：幻读

####  串行化：serializable

加锁，能解决所有问题，线程安全，但效率极低

#### 设置、查询隔离级别

- 设置：`set global transaction isolation level 级别字符串;`

- 查询：`select @@tx_isolation`